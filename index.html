<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R√®glements Praticiens 2026</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@400;500;600;700;800&family=Instrument+Sans:wght@300;400;500&display=swap');

:root {
  --bg: #f5f3ef;
  --surface: #ffffff;
  --surface2: #f0ede8;
  --border: #e2ddd7;
  --ink: #1a1714;
  --ink2: #5c5650;
  --ink3: #9a948e;
  --gold: #c8922a;
  --gold-light: #f5e6c8;
  --green: #2a7a4b;
  --green-light: #d4edde;
  --red: #c0392b;
  --red-light: #fde8e6;
  --blue: #2563eb;
  --blue-light: #dbeafe;
  --shadow: 0 1px 3px rgba(26,23,20,0.08), 0 4px 16px rgba(26,23,20,0.04);
  --shadow-lg: 0 8px 32px rgba(26,23,20,0.12);
  --radius: 12px;
}

* { box-sizing: border-box; margin: 0; padding: 0; }
html { font-size: 15px; }

body {
  font-family: 'Instrument Sans', sans-serif;
  background: var(--bg);
  color: var(--ink);
  min-height: 100vh;
}

/* ‚îÄ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ‚îÄ */
.app { display: flex; min-height: 100vh; }

.sidebar {
  width: 260px; flex-shrink: 0;
  background: var(--ink);
  display: flex; flex-direction: column;
  position: fixed; top: 0; left: 0; bottom: 0;
  z-index: 200;
}

.sidebar-logo {
  padding: 28px 24px 20px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}
.sidebar-logo h1 {
  font-family: 'Bricolage Grotesque', sans-serif;
  font-size: 13px; font-weight: 800;
  color: var(--gold); letter-spacing: 1.5px;
  text-transform: uppercase; line-height: 1.4;
}
.sidebar-logo p {
  font-size: 11px; color: rgba(255,255,255,0.35);
  margin-top: 4px;
}

.sidebar-year {
  margin: 16px;
  background: rgba(200,146,42,0.12);
  border: 1px solid rgba(200,146,42,0.25);
  border-radius: 8px; padding: 10px 14px;
  text-align: center;
}
.sidebar-year span {
  font-family: 'Bricolage Grotesque', sans-serif;
  font-size: 28px; font-weight: 800; color: var(--gold);
}

nav { padding: 8px 12px; flex: 1; }
.nav-item {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 12px; border-radius: 8px;
  cursor: pointer; color: rgba(255,255,255,0.5);
  font-size: 13px; font-weight: 500;
  transition: all 0.2s; margin-bottom: 2px;
  border: none; background: none; width: 100%; text-align: left;
}
.nav-item:hover { background: rgba(255,255,255,0.06); color: rgba(255,255,255,0.85); }
.nav-item.active { background: rgba(200,146,42,0.15); color: var(--gold); }
.nav-icon { font-size: 15px; width: 18px; text-align: center; }

.sidebar-stats {
  padding: 16px; border-top: 1px solid rgba(255,255,255,0.08);
}
.sidebar-stat { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; }
.sidebar-stat-label { font-size: 11px; color: rgba(255,255,255,0.35); }
.sidebar-stat-val { font-family: 'Bricolage Grotesque', sans-serif; font-size: 13px; font-weight: 700; color: rgba(255,255,255,0.85); }

.main { margin-left: 260px; flex: 1; min-height: 100vh; }

/* ‚îÄ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ‚îÄ */
.topbar {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 16px 32px;
  display: flex; align-items: center; justify-content: space-between;
  position: sticky; top: 0; z-index: 100;
  box-shadow: var(--shadow);
}
.topbar-title {
  font-family: 'Bricolage Grotesque', sans-serif;
  font-size: 20px; font-weight: 700; color: var(--ink);
}
.topbar-right { display: flex; gap: 10px; align-items: center; }

/* ‚îÄ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ‚îÄ */
.btn {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 9px 18px; border-radius: 8px;
  font-size: 13px; font-weight: 600;
  cursor: pointer; border: none;
  font-family: 'Instrument Sans', sans-serif;
  transition: all 0.15s;
}
.btn-gold { background: var(--gold); color: #fff; }
.btn-gold:hover { background: #b07d20; }
.btn-outline { background: none; border: 1.5px solid var(--border); color: var(--ink2); }
.btn-outline:hover { border-color: var(--ink2); color: var(--ink); }
.btn-danger { background: var(--red); color: #fff; font-size: 12px; padding: 6px 12px; }
.btn-danger:hover { background: #a93226; }
.btn-sm { padding: 5px 10px; font-size: 12px; }
.btn-green { background: var(--green); color: #fff; }
.btn-green:hover { background: #1e5e38; }

/* ‚îÄ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ‚îÄ */
.page { display: none; padding: 28px 32px; animation: fadeUp 0.25s ease; }
.page.active { display: block; }
@keyframes fadeUp { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }

/* ‚îÄ‚îÄ‚îÄ KPI GRID ‚îÄ‚îÄ‚îÄ */
.kpi-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 16px; margin-bottom: 24px; }
.kpi-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px 22px;
  box-shadow: var(--shadow);
  position: relative; overflow: hidden;
}
.kpi-card::after {
  content: ''; position: absolute;
  bottom: 0; left: 0; right: 0; height: 3px;
}
.kpi-card.gold::after { background: var(--gold); }
.kpi-card.green::after { background: var(--green); }
.kpi-card.blue::after { background: var(--blue); }
.kpi-card.red::after { background: var(--red); }

.kpi-label { font-size: 11px; text-transform: uppercase; letter-spacing: 0.8px; color: var(--ink3); margin-bottom: 10px; }
.kpi-value { font-family: 'Bricolage Grotesque', sans-serif; font-size: 24px; font-weight: 800; line-height: 1; margin-bottom: 5px; }
.kpi-card.gold .kpi-value { color: var(--gold); }
.kpi-card.green .kpi-value { color: var(--green); }
.kpi-card.blue .kpi-value { color: var(--blue); }
.kpi-card.red .kpi-value { color: var(--red); }
.kpi-sub { font-size: 12px; color: var(--ink3); }

/* ‚îÄ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ‚îÄ */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  overflow: hidden;
}
.card-header {
  padding: 18px 22px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
}
.card-title {
  font-family: 'Bricolage Grotesque', sans-serif;
  font-size: 15px; font-weight: 700; color: var(--ink);
}
.card-body { padding: 22px; }

/* ‚îÄ‚îÄ‚îÄ GRID LAYOUTS ‚îÄ‚îÄ‚îÄ */
.grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
.grid-3-1 { display: grid; grid-template-columns: 2fr 1.2fr; gap: 20px; margin-bottom: 20px; }

/* ‚îÄ‚îÄ‚îÄ MONTH TABS ‚îÄ‚îÄ‚îÄ */
.month-tabs {
  display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 20px;
}
.month-tab {
  padding: 6px 14px; border-radius: 20px;
  font-size: 12px; font-weight: 600;
  cursor: pointer; transition: all 0.15s;
  border: 1.5px solid var(--border);
  background: var(--surface); color: var(--ink2);
}
.month-tab:hover { border-color: var(--gold); color: var(--gold); }
.month-tab.active { background: var(--gold); border-color: var(--gold); color: #fff; }
.month-tab.has-data { border-color: var(--green); color: var(--green); }
.month-tab.has-data.active { background: var(--green); border-color: var(--green); color: #fff; }

/* ‚îÄ‚îÄ‚îÄ FORM ‚îÄ‚îÄ‚îÄ */
.form-modal-bg {
  display: none; position: fixed; inset: 0;
  background: rgba(26,23,20,0.5); z-index: 500;
  align-items: center; justify-content: center;
  backdrop-filter: blur(4px);
}
.form-modal-bg.open { display: flex; }

.form-modal {
  background: var(--surface);
  border-radius: 16px;
  width: 600px; max-width: 95vw;
  box-shadow: var(--shadow-lg);
  animation: modalIn 0.25s ease;
  max-height: 90vh; overflow-y: auto;
}
@keyframes modalIn { from { opacity:0; transform:scale(0.95) translateY(20px); } to { opacity:1; transform:scale(1) translateY(0); } }

.form-modal-header {
  padding: 22px 26px 18px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
}
.form-modal-title {
  font-family: 'Bricolage Grotesque', sans-serif;
  font-size: 18px; font-weight: 800;
}
.close-btn {
  width: 32px; height: 32px; border-radius: 8px;
  background: var(--surface2); border: none;
  cursor: pointer; font-size: 18px; color: var(--ink2);
  display: flex; align-items: center; justify-content: center;
  transition: all 0.15s;
}
.close-btn:hover { background: var(--red-light); color: var(--red); }

.form-body { padding: 22px 26px; }
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.form-group { display: flex; flex-direction: column; gap: 5px; }
.form-group.full { grid-column: 1/-1; }
.form-label {
  font-size: 11px; font-weight: 600;
  text-transform: uppercase; letter-spacing: 0.7px;
  color: var(--ink2);
}
.form-input, .form-select {
  padding: 10px 13px; border-radius: 8px;
  border: 1.5px solid var(--border);
  background: var(--bg);
  font-size: 13px; font-family: 'Instrument Sans', sans-serif;
  color: var(--ink); outline: none;
  transition: border-color 0.15s;
}
.form-input:focus, .form-select:focus { border-color: var(--gold); background: #fff; }
.form-input.error { border-color: var(--red); }
.error-msg { font-size: 11px; color: var(--red); margin-top: 2px; }

.form-footer {
  padding: 18px 26px;
  border-top: 1px solid var(--border);
  display: flex; gap: 10px; justify-content: flex-end;
}

/* ‚îÄ‚îÄ‚îÄ CONFIRM MODAL ‚îÄ‚îÄ‚îÄ */
.confirm-modal-bg {
  display: none; position: fixed; inset: 0;
  background: rgba(26,23,20,0.5); z-index: 600;
  align-items: center; justify-content: center;
}
.confirm-modal-bg.open { display: flex; }
.confirm-modal {
  background: var(--surface); border-radius: 12px;
  padding: 28px 32px; width: 380px;
  box-shadow: var(--shadow-lg); text-align: center;
}
.confirm-modal h3 { font-family: 'Bricolage Grotesque', sans-serif; font-size: 17px; margin-bottom: 10px; }
.confirm-modal p { font-size: 13px; color: var(--ink2); margin-bottom: 22px; }
.confirm-btns { display: flex; gap: 10px; justify-content: center; }

/* ‚îÄ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ‚îÄ */
.table-wrap { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; }
thead tr { background: var(--surface2); }
thead th {
  padding: 11px 14px; font-size: 11px;
  text-transform: uppercase; letter-spacing: 0.7px;
  color: var(--ink3); font-weight: 600;
  text-align: left; white-space: nowrap;
  cursor: pointer; user-select: none;
  border-bottom: 1px solid var(--border);
}
thead th:hover { color: var(--gold); }
tbody tr { border-bottom: 1px solid var(--border); transition: background 0.12s; }
tbody tr:hover { background: var(--surface2); }
tbody tr:last-child { border-bottom: none; }
td { padding: 11px 14px; font-size: 13px; }

.badge {
  display: inline-flex; align-items: center;
  padding: 3px 9px; border-radius: 20px;
  font-size: 11px; font-weight: 600;
}
.badge-ph { background: var(--blue-light); color: var(--blue); }
.badge-ho { background: var(--red-light); color: var(--red); }
.badge-cl { background: #ede9fe; color: #6d28d9; }
.badge-ca { background: var(--green-light); color: var(--green); }
.badge-de { background: var(--gold-light); color: var(--gold); }
.badge-op { background: #fce7f3; color: #be185d; }
.badge-la { background: #e0f2fe; color: #0369a1; }
.badge-ra { background: #fff7ed; color: #c2410c; }
.badge-au { background: var(--surface2); color: var(--ink3); }

.montant-cell {
  font-family: 'Bricolage Grotesque', sans-serif;
  font-weight: 700; color: var(--green); font-size: 13px;
}

.action-btns { display: flex; gap: 6px; }
.icon-btn {
  width: 28px; height: 28px; border-radius: 6px;
  border: 1.5px solid var(--border); background: var(--surface);
  cursor: pointer; font-size: 13px;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.12s;
}
.icon-btn.edit:hover { border-color: var(--gold); background: var(--gold-light); }
.icon-btn.del:hover { border-color: var(--red); background: var(--red-light); }

/* ‚îÄ‚îÄ‚îÄ PAGINATION ‚îÄ‚îÄ‚îÄ */
.pag {
  display: flex; align-items: center; justify-content: space-between;
  padding: 14px 20px; border-top: 1px solid var(--border);
  background: var(--surface2);
}
.pag-info { font-size: 12px; color: var(--ink3); }
.pag-btns { display: flex; gap: 5px; }
.pag-btn {
  width: 30px; height: 30px; border-radius: 6px;
  border: 1.5px solid var(--border); background: var(--surface);
  color: var(--ink2); cursor: pointer; font-size: 12px;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.12s;
}
.pag-btn:hover { border-color: var(--gold); color: var(--gold); }
.pag-btn.active { background: var(--gold); border-color: var(--gold); color: #fff; font-weight: 700; }

/* ‚îÄ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ‚îÄ */
.filters { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-bottom: 16px; }
.search-input {
  padding: 8px 14px 8px 36px; border-radius: 8px;
  border: 1.5px solid var(--border); background: var(--surface);
  font-size: 13px; outline: none; width: 240px;
  font-family: 'Instrument Sans', sans-serif;
  transition: border-color 0.15s;
}
.search-input:focus { border-color: var(--gold); }
.search-wrap { position: relative; }
.search-wrap::before {
  content: 'üîç'; position: absolute; left: 10px; top: 50%;
  transform: translateY(-50%); font-size: 13px;
}
.filter-select {
  padding: 8px 12px; border-radius: 8px;
  border: 1.5px solid var(--border); background: var(--surface);
  font-size: 13px; font-family: 'Instrument Sans', sans-serif;
  color: var(--ink); outline: none; cursor: pointer;
}
.filter-select:focus { border-color: var(--gold); }

/* ‚îÄ‚îÄ‚îÄ MONTH SUMMARY ‚îÄ‚îÄ‚îÄ */
.month-summary {
  display: flex; gap: 12px; margin-bottom: 16px;
}
.month-stat {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 10px; padding: 12px 18px;
  flex: 1;
}
.month-stat-label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.7px; color: var(--ink3); margin-bottom: 4px; }
.month-stat-val { font-family: 'Bricolage Grotesque', sans-serif; font-size: 18px; font-weight: 800; color: var(--gold); }

/* ‚îÄ‚îÄ‚îÄ EMPTY ‚îÄ‚îÄ‚îÄ */
.empty {
  text-align: center; padding: 50px 20px; color: var(--ink3);
}
.empty-icon { font-size: 40px; margin-bottom: 14px; }
.empty h3 { font-family: 'Bricolage Grotesque', sans-serif; font-size: 16px; color: var(--ink2); margin-bottom: 6px; }
.empty p { font-size: 13px; }

/* ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ */
.toast {
  position: fixed; bottom: 24px; right: 24px;
  background: var(--ink); color: #fff;
  padding: 12px 20px; border-radius: 10px;
  font-size: 13px; font-weight: 500;
  z-index: 999; display: none;
  box-shadow: var(--shadow-lg);
  animation: toastIn 0.3s ease;
  border-left: 4px solid var(--gold);
}
.toast.show { display: block; }
@keyframes toastIn { from { transform: translateX(100%); opacity:0; } to { transform: translateX(0); opacity:1; } }

/* ‚îÄ‚îÄ‚îÄ CHART CARD ‚îÄ‚îÄ‚îÄ */
.chart-card { margin-bottom: 20px; }

/* ‚îÄ‚îÄ‚îÄ BAR STAT ‚îÄ‚îÄ‚îÄ */
.bar-stat { display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid var(--border); }
.bar-stat:last-child { border-bottom: none; }
.bar-name { font-size: 12px; color: var(--ink); min-width: 150px; max-width: 180px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
.bar-track { flex: 1; height: 5px; background: var(--border); border-radius: 3px; overflow: hidden; }
.bar-fill { height: 100%; border-radius: 3px; background: var(--gold); transition: width 0.6s ease; }
.bar-val { font-family: 'Bricolage Grotesque', sans-serif; font-size: 12px; font-weight: 700; color: var(--gold); min-width: 70px; text-align: right; }

/* ‚îÄ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ‚îÄ */
.loading {
  text-align: center; padding: 60px;
  color: var(--ink3); font-size: 14px;
}

@media print {
  .sidebar, .topbar-right, .filters, .action-btns, .pag, .form-modal-bg, .confirm-modal-bg { display: none !important; }
  .main { margin-left: 0; }
  .page { padding: 16px; }
}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- √âCRAN DE CONNEXION                          -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="login-screen" style="
  position:fixed;inset:0;z-index:9999;
  background:linear-gradient(135deg,#1a1714 0%,#2d2720 50%,#1a1714 100%);
  display:flex;align-items:center;justify-content:center;
  font-family:'Instrument Sans',sans-serif;
">
  <div style="
    background:rgba(255,255,255,0.04);
    border:1px solid rgba(200,146,42,0.3);
    border-radius:20px;
    padding:48px 40px;
    width:380px;max-width:95vw;
    box-shadow:0 32px 80px rgba(0,0,0,0.5);
    text-align:center;
  ">
    <div style="font-size:48px;margin-bottom:16px">üè•</div>
    <h1 style="
      font-family:'Bricolage Grotesque',sans-serif;
      font-size:20px;font-weight:800;
      color:#c8922a;letter-spacing:1px;
      text-transform:uppercase;margin-bottom:6px;
    ">R√®glements Praticiens</h1>
    <p style="font-size:12px;color:rgba(255,255,255,0.35);margin-bottom:32px;">IPM RIDWAN ‚Äî Acc√®s s√©curis√©</p>

    <div style="position:relative;margin-bottom:12px;">
      <input type="password" id="pwd-input"
        placeholder="Mot de passe..."
        onkeydown="if(event.key==='Enter')checkPassword()"
        style="
          width:100%;padding:14px 48px 14px 18px;
          border-radius:10px;border:1.5px solid rgba(200,146,42,0.3);
          background:rgba(255,255,255,0.06);
          color:#fff;font-size:15px;
          font-family:'Instrument Sans',sans-serif;
          outline:none;box-sizing:border-box;
          transition:border-color 0.2s;
        "
        onfocus="this.style.borderColor='#c8922a'"
        onblur="this.style.borderColor='rgba(200,146,42,0.3)'"
      >
      <button onclick="togglePwd()" style="
        position:absolute;right:14px;top:50%;transform:translateY(-50%);
        background:none;border:none;cursor:pointer;font-size:18px;color:rgba(255,255,255,0.4);
      " id="pwd-eye">üëÅÔ∏è</button>
    </div>

    <div id="pwd-error" style="
      color:#e74c3c;font-size:12px;margin-bottom:12px;
      min-height:18px;font-weight:600;
    "></div>

    <button onclick="checkPassword()" style="
      width:100%;padding:14px;border-radius:10px;
      background:#c8922a;border:none;cursor:pointer;
      color:#fff;font-size:15px;font-weight:700;
      font-family:'Instrument Sans',sans-serif;
      transition:background 0.15s;
    "
    onmouseover="this.style.background='#b07d20'"
    onmouseout="this.style.background='#c8922a'"
    >üîì Acc√©der</button>

    <p style="font-size:11px;color:rgba(255,255,255,0.2);margin-top:24px;">
      Acc√®s r√©serv√© au personnel autoris√©
    </p>
  </div>
</div>

<style>
@import url('https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@400;500;600;700;800&family=Instrument+Sans:wght@300;400;500&display=swap');
#pwd-input::placeholder { color: rgba(255,255,255,0.25); }
</style>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MOT DE PASSE ‚Äî modifie ici !
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const APP_PASSWORD = 'IPM2026@';  // ‚Üê Change ce mot de passe !

function checkPassword() {
  const val = document.getElementById('pwd-input').value;
  const err = document.getElementById('pwd-error');
  if (val === APP_PASSWORD) {
    sessionStorage.setItem('ipm-auth', '1');
    document.getElementById('login-screen').style.opacity = '0';
    document.getElementById('login-screen').style.transition = 'opacity 0.4s';
    setTimeout(() => document.getElementById('login-screen').style.display = 'none', 400);
  } else {
    err.textContent = '‚ùå Mot de passe incorrect !';
    document.getElementById('pwd-input').style.borderColor = '#e74c3c';
    document.getElementById('pwd-input').value = '';
    setTimeout(() => {
      err.textContent = '';
      document.getElementById('pwd-input').style.borderColor = 'rgba(200,146,42,0.3)';
    }, 2500);
  }
}

function togglePwd() {
  const inp = document.getElementById('pwd-input');
  inp.type = inp.type === 'password' ? 'text' : 'password';
}

// V√©rifier si d√©j√† authentifi√© dans cette session
if (sessionStorage.getItem('ipm-auth') === '1') {
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('login-screen').style.display = 'none';
  });
}
</script>

<div class="app">

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <h1>R√®glements<br>Praticiens</h1>
    <p>Gestion & Suivi</p>
  </div>
  <div class="sidebar-year"><span>2026</span></div>
  <nav>
    <button class="nav-item active" onclick="nav('dashboard',this)"><span class="nav-icon">üìä</span> Dashboard</button>
    <button class="nav-item" onclick="nav('saisie',this)"><span class="nav-icon">‚úçÔ∏è</span> Saisie rapide</button>
    <button class="nav-item" onclick="nav('reglements',this)"><span class="nav-icon">üìã</span> R√®glements</button>
    <button class="nav-item" onclick="nav('categories',this)"><span class="nav-icon">üè•</span> Cat√©gories</button>
  </nav>
  <div class="sidebar-stats">
    <div class="sidebar-stat">
      <span class="sidebar-stat-label">Enregistrements</span>
      <span class="sidebar-stat-val" id="sb-count">‚Äî</span>
    </div>
    <div class="sidebar-stat">
      <span class="sidebar-stat-label">Total 2026</span>
      <span class="sidebar-stat-val" id="sb-total">‚Äî</span>
    </div>
    <div class="sidebar-stat">
      <span class="sidebar-stat-label">Mois actif</span>
      <span class="sidebar-stat-val" id="sb-month">‚Äî</span>
    </div>
  </div>
</aside>

<!-- MAIN -->
<div class="main">

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="topbar-title" id="page-title">Dashboard 2026</div>
    <div class="topbar-right">
      <div style="position:relative;display:inline-block" id="export-menu-wrap">
        <button class="btn btn-outline" onclick="toggleExportMenu()">‚¨áÔ∏è Exporter ‚ñæ</button>
        <div id="export-menu" style="display:none;position:absolute;top:110%;right:0;background:#fff;border:1.5px solid var(--border);border-radius:10px;box-shadow:var(--shadow-lg);min-width:210px;z-index:300;overflow:hidden;">
          <div style="padding:6px 0;">
            <button onclick="exportExcel();toggleExportMenu()" style="display:flex;align-items:center;gap:10px;width:100%;padding:10px 16px;border:none;background:none;cursor:pointer;font-size:13px;color:var(--ink);text-align:left;font-family:inherit;" onmouseover="this.style.background='var(--surface2)'" onmouseout="this.style.background='none'">üìä <span><strong>Export Excel</strong><br><small style="color:var(--ink3)">.csv pour Excel/Sheets</small></span></button>
            <button onclick="exportCSV();toggleExportMenu()" style="display:flex;align-items:center;gap:10px;width:100%;padding:10px 16px;border:none;background:none;cursor:pointer;font-size:13px;color:var(--ink);text-align:left;font-family:inherit;" onmouseover="this.style.background='var(--surface2)'" onmouseout="this.style.background='none'">üìã <span><strong>Export CSV</strong><br><small style="color:var(--ink3)">Format universel</small></span></button>
            <div style="height:1px;background:var(--border);margin:4px 0"></div>
            <button onclick="exportJSON();toggleExportMenu()" style="display:flex;align-items:center;gap:10px;width:100%;padding:10px 16px;border:none;background:none;cursor:pointer;font-size:13px;color:var(--ink);text-align:left;font-family:inherit;" onmouseover="this.style.background='var(--surface2)'" onmouseout="this.style.background='none'">üíæ <span><strong>Backup JSON</strong><br><small style="color:var(--ink3)">Sauvegarde compl√®te</small></span></button>
            <button onclick="importJSON();toggleExportMenu()" style="display:flex;align-items:center;gap:10px;width:100%;padding:10px 16px;border:none;background:none;cursor:pointer;font-size:13px;color:var(--green);text-align:left;font-family:inherit;" onmouseover="this.style.background='var(--green-light)'" onmouseout="this.style.background='none'">üìÇ <span><strong>Restaurer JSON</strong><br><small style="color:var(--ink3)">Importer un backup</small></span></button>
          </div>
        </div>
      </div>
      <button class="btn btn-outline" onclick="window.print()">üñ®Ô∏è Imprimer</button>
      <button class="btn btn-gold" onclick="openForm()">Ôºã Nouveau r√®glement</button>
    </div>
  </div>

  <!-- DASHBOARD PAGE -->
  <div class="page active" id="page-dashboard">

    <div class="kpi-grid" id="kpi-grid">
      <div class="kpi-card gold">
        <div class="kpi-label">Total 2026</div>
        <div class="kpi-value" id="kpi-total">0 FCFA</div>
        <div class="kpi-sub" id="kpi-sub-total">Aucun r√®glement</div>
      </div>
      <div class="kpi-card green">
        <div class="kpi-label">Mois en cours</div>
        <div class="kpi-value" id="kpi-month">0 FCFA</div>
        <div class="kpi-sub" id="kpi-sub-month">‚Äî</div>
      </div>
      <div class="kpi-card blue">
        <div class="kpi-label">Praticiens distincts</div>
        <div class="kpi-value" id="kpi-prat">0</div>
        <div class="kpi-sub" id="kpi-sub-prat">‚Äî</div>
      </div>
      <div class="kpi-card red">
        <div class="kpi-label">Dernier ajout</div>
        <div class="kpi-value" id="kpi-last">‚Äî</div>
        <div class="kpi-sub" id="kpi-sub-last">‚Äî</div>
      </div>
    </div>

    <div class="grid-3-1">
      <div class="card chart-card">
        <div class="card-header">
          <span class="card-title">√âvolution mensuelle 2026</span>
        </div>
        <div class="card-body">
          <canvas id="chart-evolution" height="100"></canvas>
        </div>
      </div>
      <div class="card chart-card">
        <div class="card-header">
          <span class="card-title">Par cat√©gorie</span>
        </div>
        <div class="card-body">
          <canvas id="chart-cat" height="180"></canvas>
        </div>
      </div>
    </div>

    <div class="grid-2">
      <div class="card">
        <div class="card-header"><span class="card-title">Top 8 praticiens</span></div>
        <div class="card-body" id="top-prat-list"></div>
      </div>
      <div class="card">
        <div class="card-header"><span class="card-title">Derniers r√®glements saisis</span></div>
        <div class="card-body" id="recent-list"></div>
      </div>
    </div>

  </div>

  <!-- SAISIE PAGE -->
  <div class="page" id="page-saisie">
    <div style="max-width:640px;">

      <!-- IMPORT EXCEL CARD -->
      <div class="card" style="margin-bottom:20px;border:2px dashed var(--gold);background:var(--gold-light);">
        <div class="card-header" style="background:transparent;border-bottom:1px solid rgba(200,146,42,0.2);">
          <span class="card-title">üì• Import Excel / CSV ‚Äî Plusieurs r√®glements en 1 clic</span>
          <button class="btn btn-outline btn-sm" onclick="downloadTemplate()">‚¨áÔ∏è T√©l√©charger le mod√®le</button>
        </div>
        <div class="card-body">
          <!-- Zone de drop -->
          <div id="drop-zone" onclick="document.getElementById('csv-file-input').click()"
            style="
              border:2px dashed rgba(200,146,42,0.4);border-radius:10px;
              padding:28px;text-align:center;cursor:pointer;
              transition:all 0.2s;background:rgba(255,255,255,0.5);
            "
            ondragover="event.preventDefault();this.style.background='rgba(200,146,42,0.15)'"
            ondragleave="this.style.background='rgba(255,255,255,0.5)'"
            ondrop="handleFileDrop(event)"
          >
            <div style="font-size:36px;margin-bottom:8px">üìä</div>
            <div style="font-weight:700;color:var(--gold);font-size:14px;margin-bottom:4px">Glisse ton fichier ici ou clique pour s√©lectionner</div>
            <div style="font-size:12px;color:var(--ink3)">Formats accept√©s : .csv ou .xlsx (Excel)</div>
            <input type="file" id="csv-file-input" accept=".csv,.xlsx,.xls" style="display:none" onchange="handleFileSelect(this)">
          </div>

          <!-- Aper√ßu avant import -->
          <div id="import-preview" style="display:none;margin-top:16px;">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
              <span style="font-weight:700;color:var(--ink);font-size:13px;" id="import-preview-title">Aper√ßu</span>
              <div style="display:flex;gap:8px;">
                <button class="btn btn-outline btn-sm" onclick="cancelImport()">‚úï Annuler</button>
                <button class="btn btn-green btn-sm" onclick="confirmImport()" id="import-confirm-btn">‚úÖ Importer</button>
              </div>
            </div>
            <div style="overflow-x:auto;border-radius:8px;border:1px solid var(--border);">
              <table style="width:100%;border-collapse:collapse;font-size:12px;">
                <thead>
                  <tr style="background:var(--surface2);">
                    <th style="padding:8px 10px;text-align:left;color:var(--ink3);font-size:11px;">#</th>
                    <th style="padding:8px 10px;text-align:left;color:var(--ink3);font-size:11px;">PRATICIEN</th>
                    <th style="padding:8px 10px;text-align:left;color:var(--ink3);font-size:11px;">CAT√âGORIE</th>
                    <th style="padding:8px 10px;text-align:left;color:var(--ink3);font-size:11px;">MONTANT</th>
                    <th style="padding:8px 10px;text-align:left;color:var(--ink3);font-size:11px;">DATE</th>
                    <th style="padding:8px 10px;text-align:left;color:var(--ink3);font-size:11px;">MODE</th>
                    <th style="padding:8px 10px;text-align:left;color:var(--ink3);font-size:11px;">BANQUE</th>
                    <th style="padding:8px 10px;text-align:left;color:var(--ink3);font-size:11px;">STATUT</th>
                  </tr>
                </thead>
                <tbody id="import-preview-body"></tbody>
              </table>
            </div>
            <div id="import-summary" style="margin-top:10px;font-size:12px;color:var(--ink3);"></div>
          </div>

          <!-- Instructions -->
          <div style="margin-top:14px;padding:12px;background:rgba(255,255,255,0.6);border-radius:8px;font-size:12px;color:var(--ink2);">
            <strong>üìã Format requis (colonnes dans l'ordre) :</strong><br>
            <span style="font-family:monospace;color:var(--gold)">Mois | Praticien | Cat√©gorie | Montant | Date | Mode | Banque | Commentaire</span><br><br>
            <strong>üí° Astuce :</strong> T√©l√©charge le mod√®le ‚Üí remplis-le dans Excel ‚Üí importe-le ici !
          </div>
        </div>
      </div>

      <!-- FORMULAIRE SAISIE MANUELLE -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">‚úçÔ∏è Saisie manuelle</span>
          <span style="font-size:12px;color:var(--ink3)">Num√©ro auto-incr√©ment√©</span>
        </div>
        <div class="card-body">
          <div id="inline-form"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- REGLEMENTS PAGE -->
  <div class="page" id="page-reglements">

    <div class="month-tabs" id="month-tabs"></div>

    <div id="month-summary-bar" class="month-summary"></div>

    <div class="filters">
      <div class="search-wrap">
        <input type="text" class="search-input" id="search-input" placeholder="Rechercher praticien..." oninput="applyFilters()">
      </div>
      <select class="filter-select" id="f-cat" onchange="applyFilters()">
        <option value="">Toutes cat√©gories</option>
        <option>PHARMACIE</option>
        <option>HOPITAL</option>
        <option>CLINIQUE</option>
        <option>CABINET/PLATEAU M√âDICAL</option>
        <option>DENTISTE</option>
        <option>OPTICIEN</option>
        <option>LABORATOIRE</option>
        <option>RADIOLOGIE</option>
      </select>
      <select class="filter-select" id="f-mode" onchange="applyFilters()">
        <option value="">Tous modes</option>
        <option>VIREMENT</option>
        <option>ESPECES</option>
      </select>
      <button class="btn btn-outline btn-sm" onclick="resetFilters()">‚úï Reset</button>
      <span id="filter-count" style="font-size:12px;color:var(--ink3);margin-left:auto;"></span>
      <button class="btn btn-gold btn-sm" onclick="openForm()">Ôºã Ajouter</button>
    </div>

    <div class="card">
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th onclick="sortBy('num')">N¬∞ ‚Üï</th>
              <th onclick="sortBy('praticien')">Praticien ‚Üï</th>
              <th onclick="sortBy('categorie')">Cat√©gorie</th>
              <th onclick="sortBy('montant')">Montant ‚Üï</th>
              <th onclick="sortBy('date')">Date ‚Üï</th>
              <th>Mode</th>
              <th>Banque</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="table-body"></tbody>
        </table>
      </div>
      <div class="pag">
        <span class="pag-info" id="pag-info">‚Äî</span>
        <div class="pag-btns" id="pag-btns"></div>
      </div>
    </div>
  </div>

  <!-- CATEGORIES PAGE -->
  <div class="page" id="page-categories">
    <div class="grid-2">
      <div class="card">
        <div class="card-header"><span class="card-title">Montants par cat√©gorie</span></div>
        <div class="card-body"><canvas id="chart-cat-bar" height="220"></canvas></div>
      </div>
      <div class="card">
        <div class="card-header"><span class="card-title">Nombre de r√®glements</span></div>
        <div class="card-body"><canvas id="chart-cat-count" height="220"></canvas></div>
      </div>
    </div>
    <div class="card">
      <div class="card-header"><span class="card-title">D√©tail par cat√©gorie</span></div>
      <div class="card-body" id="cat-detail"></div>
    </div>
  </div>

</div><!-- /main -->
</div><!-- /app -->

<!-- FORM MODAL -->
<div class="form-modal-bg" id="form-modal-bg" onclick="if(event.target===this)closeForm()">
  <div class="form-modal">
    <div class="form-modal-header">
      <span class="form-modal-title" id="modal-title">Nouveau r√®glement</span>
      <button class="close-btn" onclick="closeForm()">√ó</button>
    </div>
    <div class="form-body" id="modal-form-body"></div>
    <div class="form-footer">
      <button class="btn btn-outline" onclick="closeForm()">Annuler</button>
      <button class="btn btn-gold" onclick="saveForm()">üíæ Enregistrer</button>
    </div>
  </div>
</div>

<!-- CONFIRM MODAL -->
<div class="confirm-modal-bg" id="confirm-bg">
  <div class="confirm-modal">
    <div style="font-size:36px;margin-bottom:12px">üóëÔ∏è</div>
    <h3>Supprimer ce r√®glement ?</h3>
    <p id="confirm-text">Cette action est irr√©versible.</p>
    <div class="confirm-btns">
      <button class="btn btn-outline" onclick="closeConfirm()">Annuler</button>
      <button class="btn btn-danger" onclick="confirmDelete()">Supprimer</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONSTANTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const MONTHS_2026 = [
  'JANVIER 2026','FEVRIER 2026','MARS 2026','AVRIL 2026',
  'MAI 2026','JUIN 2026','JUILLET 2026','AOUT 2026',
  'SEPTEMBRE 2026','OCTOBRE 2026','NOVEMBRE 2026','DECEMBRE 2026'
];

const CATS = ['PHARMACIE','HOPITAL','CLINIQUE','CABINET/PLATEAU M√âDICAL','DENTISTE','OPTICIEN','LABORATOIRE','RADIOLOGIE','AUTRE'];
const BANQUES = ['FBN BANK','BNP PARIBAS','CBAO','SUNU BANK','BOA','ECOBANK','UBA','AUTRE'];
const CAT_COLORS = {
  'PHARMACIE':'#2563eb','HOPITAL':'#c0392b','CLINIQUE':'#6d28d9',
  'CABINET/PLATEAU M√âDICAL':'#2a7a4b','DENTISTE':'#c8922a','OPTICIEN':'#be185d',
  'LABORATOIRE':'#0369a1','RADIOLOGIE':'#c2410c','AUTRE':'#9a948e'
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let allData = [];
let filteredData = [];
let activeMonth = MONTHS_2026[new Date().getMonth()] || MONTHS_2026[0];
let sortState = { col: 'num', dir: 1 };
let currentPage = 1;
const PER_PAGE = 20;
let editId = null;
let deleteId = null;
let charts = {};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FIREBASE CONFIG ‚Äî Base de donn√©es partag√©e temps r√©el
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const FIREBASE_URL = 'https://ipm-ridwan-default-rtdb.europe-west1.firebasedatabase.app';
const DB_PATH = '/reglements2026';

async function loadData() {
  try {
    showLoadingIndicator(true);
    const res = await fetch(FIREBASE_URL + DB_PATH + '.json');
    const data = await res.json();
    allData = data ? Object.values(data) : [];
    // Stocker les Firebase keys pour les updates/deletes
    if (data) {
      window._fbKeys = {};
      Object.entries(data).forEach(([k,v]) => { window._fbKeys[v.id] = k; });
    } else {
      window._fbKeys = {};
    }
  } catch(e) {
    console.error('Firebase load error:', e);
    // Fallback localStorage
    try { allData = JSON.parse(localStorage.getItem('reglements-2026-data') || '[]'); } catch(_) { allData = []; }
    showToast('‚ö†Ô∏è Connexion Firebase impossible ‚Äî mode local activ√©');
  }
  showLoadingIndicator(false);
  renderAll();
}

async function saveData() {
  try {
    // Sauvegarder chaque item avec son ID Firebase
    const payload = {};
    allData.forEach(d => {
      const fbKey = (window._fbKeys && window._fbKeys[d.id]) || d.id;
      payload[fbKey] = d;
      if (!window._fbKeys) window._fbKeys = {};
      window._fbKeys[d.id] = fbKey;
    });
    await fetch(FIREBASE_URL + DB_PATH + '.json', {
      method: 'PUT',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(payload)
    });
    // Backup localStorage aussi
    localStorage.setItem('reglements-2026-data', JSON.stringify(allData));
  } catch(e) {
    // Fallback localStorage
    localStorage.setItem('reglements-2026-data', JSON.stringify(allData));
    showToast('‚ö†Ô∏è Sauvegarde locale uniquement');
  }
}

function showLoadingIndicator(show) {
  let el = document.getElementById('fb-loading');
  if (!el) {
    el = document.createElement('div');
    el.id = 'fb-loading';
    el.style.cssText = 'position:fixed;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,#c8922a,#f5e6c8,#c8922a);background-size:200%;animation:fbload 1s infinite;z-index:9999;display:none;';
    document.head.insertAdjacentHTML('beforeend','<style>@keyframes fbload{0%{background-position:0%}100%{background-position:200%}}</style>');
    document.body.appendChild(el);
  }
  el.style.display = show ? 'block' : 'none';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EXPORT EXCEL (via CSV bien format√© pour Excel)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function exportExcel() {
  // Cr√©e un vrai fichier Excel-compatible avec mise en forme
  const rows = [
    ['N¬∞','Mois','Praticien','Cat√©gorie','Montant (FCFA)','Date','Mode de r√®glement','Banque','Commentaire']
  ];
  allData.forEach(d => rows.push([
    d.num||'', d.month, d.praticien, normCat(d.categorie),
    d.montant, d.date||'', d.reglement||'', d.banque||'', d.commentaire||''
  ]));
  // S√©parateur point-virgule pour Excel fran√ßais
  const csv = rows.map(r => r.map(c => '"'+String(c).replace(/"/g,'""')+'"').join(';')).join('\r\n');
  const blob = new Blob(['\uFEFF'+csv], {type:'text/csv;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `reglements_praticiens_2026_${new Date().toISOString().slice(0,10)}.csv`;
  a.click();
  showToast('‚úÖ Export Excel pr√™t ! Ouvrez avec Excel.');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BACKUP JSON (sauvegarde compl√®te)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function exportJSON() {
  const backup = {
    version: '1.0',
    date: new Date().toISOString(),
    count: allData.length,
    data: allData
  };
  const blob = new Blob([JSON.stringify(backup, null, 2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `backup_reglements_2026_${new Date().toISOString().slice(0,10)}.json`;
  a.click();
  showToast('‚úÖ Backup JSON t√©l√©charg√© !');
}

function importJSON() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  input.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      try {
        const backup = JSON.parse(ev.target.result);
        const imported = backup.data || backup;
        if (!Array.isArray(imported)) throw new Error('Format invalide');
        if (confirm(`Importer ${imported.length} r√®glement(s) ?\n\nCela REMPLACERA toutes vos donn√©es actuelles (${allData.length} r√®glements).`)) {
          allData = imported;
          saveData();
          renderAll();
          showToast(`‚úÖ ${imported.length} r√®glements import√©s !`);
        }
      } catch(err) {
        alert('‚ùå Fichier invalide : ' + err.message);
      }
    };
    reader.readAsText(file);
  };
  input.click();
}

function nextNum(month) {
  const monthData = allData.filter(d => d.month === month);
  if (monthData.length === 0) return 1;
  return Math.max(...monthData.map(d => d.num || 0)) + 1;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function nav(page, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  if (btn) btn.classList.add('active');
  const titles = { dashboard:'Dashboard 2026', saisie:'Saisie rapide', reglements:'R√®glements', categories:'Analyse par Cat√©gorie' };
  document.getElementById('page-title').textContent = titles[page];
  if (page === 'dashboard') renderDashboard();
  if (page === 'saisie') renderInlineForm();
  if (page === 'reglements') { renderMonthTabs(); applyFilters(); }
  if (page === 'categories') renderCategories();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function fmt(n) {
  if (!n && n !== 0) return '‚Äî';
  return new Intl.NumberFormat('fr-FR').format(Math.round(n)) + ' FCFA';
}
function fmtShort(n) {
  if (!n) return '0';
  if (n >= 1_000_000) return (n/1_000_000).toFixed(1) + 'M';
  if (n >= 1_000) return (n/1_000).toFixed(0) + 'k';
  return n.toString();
}
function normCat(cat) {
  if (!cat) return 'AUTRE';
  const c = cat.toUpperCase().trim();
  if (c.includes('PHARMACIE')) return 'PHARMACIE';
  if (c.includes('HOPITAL') || c.includes('CHR') || c.includes('CHN') || c.includes('CHU') || c.includes('CS ') || c.includes('CENTRE') || c.includes('DISTRICT') || c.includes('POSTE') || c.includes('SAMU') || c.includes('EPS')) return 'HOPITAL';
  if (c.includes('CLINIQUE') || c.includes('POLYCLIN')) return 'CLINIQUE';
  if (c.includes('CABINET') || c.includes('PLATEAU')) return 'CABINET/PLATEAU M√âDICAL';
  if (c.includes('DENTISTE')) return 'DENTISTE';
  if (c.includes('OPTICIEN')) return 'OPTICIEN';
  if (c.includes('LABORATOIRE') || c.includes('LABO')) return 'LABORATOIRE';
  if (c.includes('RADIOLOGIE')) return 'RADIOLOGIE';
  return cat;
}
function badgeClass(cat) {
  const c = normCat(cat);
  const map = { 'PHARMACIE':'ph','HOPITAL':'ho','CLINIQUE':'cl','CABINET/PLATEAU M√âDICAL':'ca','DENTISTE':'de','OPTICIEN':'op','LABORATOIRE':'la','RADIOLOGIE':'ra' };
  return 'badge badge-' + (map[c] || 'au');
}
function uid() { return Date.now().toString(36) + Math.random().toString(36).slice(2); }
function currentMonthName() {
  const mois = ['JANVIER','FEVRIER','MARS','AVRIL','MAI','JUIN','JUILLET','AOUT','SEPTEMBRE','OCTOBRE','NOVEMBRE','DECEMBRE'];
  return mois[new Date().getMonth()] + ' 2026';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER ALL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderAll() {
  updateSidebar();
  if (document.getElementById('page-dashboard').classList.contains('active')) renderDashboard();
  if (document.getElementById('page-reglements').classList.contains('active')) { renderMonthTabs(); applyFilters(); }
  if (document.getElementById('page-categories').classList.contains('active')) renderCategories();
}

function updateSidebar() {
  document.getElementById('sb-count').textContent = allData.length;
  const total = allData.reduce((s,d) => s + (d.montant||0), 0);
  document.getElementById('sb-total').textContent = fmtShort(total) + ' FCFA';
  const cm = currentMonthName();
  const monthData = allData.filter(d => d.month === cm);
  document.getElementById('sb-month').textContent = monthData.length ? fmtShort(monthData.reduce((s,d)=>s+d.montant,0)) : '0';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDashboard() {
  const total = allData.reduce((s,d) => s + (d.montant||0), 0);
  const cm = currentMonthName();
  const monthData = allData.filter(d => d.month === cm);
  const monthTotal = monthData.reduce((s,d) => s + (d.montant||0), 0);
  const uniquePrat = new Set(allData.map(d => d.praticien)).size;
  const last = allData.slice().sort((a,b) => (b.createdAt||0) - (a.createdAt||0))[0];

  document.getElementById('kpi-total').textContent = fmtShort(total) + ' FCFA';
  document.getElementById('kpi-sub-total').textContent = `${allData.length} r√®glement${allData.length>1?'s':''}`;
  document.getElementById('kpi-month').textContent = fmtShort(monthTotal) + ' FCFA';
  document.getElementById('kpi-sub-month').textContent = cm + ' ‚Äî ' + monthData.length + ' r√©gl.';
  document.getElementById('kpi-prat').textContent = uniquePrat;
  document.getElementById('kpi-sub-prat').textContent = `${new Set(allData.map(d=>d.month)).size} mois avec donn√©es`;
  document.getElementById('kpi-last').textContent = last ? last.praticien.substring(0,15)+'‚Ä¶' : '‚Äî';
  document.getElementById('kpi-sub-last').textContent = last ? fmt(last.montant) : 'Aucun r√®glement';

  // Chart evolution
  const monthTotals = MONTHS_2026.map(m => allData.filter(d=>d.month===m).reduce((s,d)=>s+d.montant,0));
  const labels = MONTHS_2026.map(m => m.split(' ')[0].substring(0,4));
  if (charts.evo) charts.evo.destroy();
  charts.evo = new Chart(document.getElementById('chart-evolution'), {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        data: monthTotals,
        backgroundColor: monthTotals.map(v => v > 0 ? '#c8922a' : '#e2ddd7'),
        borderRadius: 6, borderSkipped: false
      }]
    },
    options: {
      responsive: true,
      plugins: { legend:{display:false}, tooltip:{callbacks:{label:ctx=>fmt(ctx.raw)}} },
      scales: {
        x:{grid:{display:false}, ticks:{color:'#9a948e',font:{size:10}}},
        y:{grid:{color:'#f0ede8'}, ticks:{color:'#9a948e',callback:v=>fmtShort(v)}}
      }
    }
  });

  // Chart cat donut
  const catMap = {};
  allData.forEach(d => { const c=normCat(d.categorie); catMap[c]=(catMap[c]||0)+d.montant; });
  const catE = Object.entries(catMap).sort((a,b)=>b[1]-a[1]);
  if (charts.cat) charts.cat.destroy();
  if (catE.length === 0) {
    document.getElementById('chart-cat').parentElement.innerHTML = '<div class="empty"><div class="empty-icon">üìä</div><p>Aucune donn√©e</p></div>';
  } else {
    charts.cat = new Chart(document.getElementById('chart-cat'), {
      type: 'doughnut',
      data: {
        labels: catE.map(e=>e[0]),
        datasets: [{ data: catE.map(e=>e[1]), backgroundColor: catE.map(e=>CAT_COLORS[e[0]]||'#9a948e'), borderWidth: 0 }]
      },
      options: { responsive:true, cutout:'60%', plugins:{legend:{position:'bottom',labels:{color:'#5c5650',font:{size:10},padding:8}}, tooltip:{callbacks:{label:ctx=>ctx.label+': '+fmt(ctx.raw)}}} }
    });
  }

  // Top praticiens
  const pMap = {};
  allData.forEach(d => pMap[d.praticien]=(pMap[d.praticien]||0)+d.montant);
  const top8 = Object.entries(pMap).sort((a,b)=>b[1]-a[1]).slice(0,8);
  const maxV = top8[0]?.[1] || 1;
  document.getElementById('top-prat-list').innerHTML = top8.length ? top8.map(([n,v]) => `
    <div class="bar-stat">
      <span class="bar-name" title="${n}">${n}</span>
      <div class="bar-track"><div class="bar-fill" style="width:${(v/maxV*100).toFixed(1)}%"></div></div>
      <span class="bar-val">${fmtShort(v)}</span>
    </div>`).join('') : '<div class="empty"><p>Aucune donn√©e</p></div>';

  // Recent
  const recent = allData.slice().sort((a,b)=>(b.createdAt||0)-(a.createdAt||0)).slice(0,6);
  document.getElementById('recent-list').innerHTML = recent.length ? recent.map(d => `
    <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);">
      <div>
        <div style="font-size:12px;font-weight:600;color:var(--ink)">${d.praticien.substring(0,30)}${d.praticien.length>30?'‚Ä¶':''}</div>
        <div style="font-size:11px;color:var(--ink3)">${d.month} ¬∑ ${d.date||'‚Äî'}</div>
      </div>
      <span style="font-family:Bricolage Grotesque,sans-serif;font-size:13px;font-weight:700;color:var(--green)">${fmtShort(d.montant)}</span>
    </div>`).join('') : '<div class="empty"><p>Aucune donn√©e</p></div>';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FORM (modal + inline)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function formHTML(data = {}, isInline = false) {
  const month = data.month || currentMonthName();
  const monthOptions = MONTHS_2026.map(m => `<option value="${m}" ${m===month?'selected':''}>${m}</option>`).join('');
  const catOptions = CATS.map(c => `<option value="${c}" ${c===(data.categorie||'')?'selected':''}>${c}</option>`).join('');
  const bankOptions = BANQUES.map(b => `<option value="${b}" ${b===(data.banque||'FBN BANK')?'selected':''}>${b}</option>`).join('');

  return `
    <div class="form-grid" id="${isInline?'il':'fm'}-grid">
      <div class="form-group">
        <label class="form-label">Mois *</label>
        <select class="form-select" id="${isInline?'il':'fm'}-month">${monthOptions}</select>
      </div>
      <div class="form-group">
        <label class="form-label">Date de paiement *</label>
        <input type="date" class="form-input" id="${isInline?'il':'fm'}-date" value="${data.date||new Date().toISOString().slice(0,10)}">
      </div>
      <div class="form-group full">
        <label class="form-label">Praticien *</label>
        <input type="text" class="form-input" id="${isInline?'il':'fm'}-praticien" placeholder="Nom du praticien / √©tablissement" value="${data.praticien||''}" list="${isInline?'il':'fm'}-prat-list">
        <datalist id="${isInline?'il':'fm'}-prat-list">${[...new Set(allData.map(d=>d.praticien))].map(p=>`<option value="${p}">`).join('')}</datalist>
        <span class="error-msg" id="${isInline?'il':'fm'}-err-praticien"></span>
      </div>
      <div class="form-group">
        <label class="form-label">Cat√©gorie *</label>
        <select class="form-select" id="${isInline?'il':'fm'}-categorie"><option value="">-- Choisir --</option>${catOptions}</select>
        <span class="error-msg" id="${isInline?'il':'fm'}-err-categorie"></span>
      </div>
      <div class="form-group">
        <label class="form-label">Montant (FCFA) *</label>
        <input type="number" class="form-input" id="${isInline?'il':'fm'}-montant" placeholder="ex: 1500000" value="${data.montant||''}" min="1">
        <span class="error-msg" id="${isInline?'il':'fm'}-err-montant"></span>
      </div>
      <div class="form-group">
        <label class="form-label">Mode de r√®glement</label>
        <select class="form-select" id="${isInline?'il':'fm'}-mode">
          <option value="VIREMENT" ${(data.reglement||'VIREMENT')==='VIREMENT'?'selected':''}>Virement</option>
          <option value="ESPECES" ${data.reglement==='ESPECES'?'selected':''}>Esp√®ces</option>
          <option value="CHEQUE" ${data.reglement==='CHEQUE'?'selected':''}>Ch√®que</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Banque</label>
        <select class="form-select" id="${isInline?'il':'fm'}-banque">${bankOptions}</select>
      </div>
      <div class="form-group full">
        <label class="form-label">Commentaire</label>
        <input type="text" class="form-input" id="${isInline?'il':'fm'}-comment" placeholder="Optionnel..." value="${data.commentaire||''}">
      </div>
    </div>`;
}

function collectForm(prefix) {
  return {
    month: document.getElementById(prefix+'-month').value,
    date: document.getElementById(prefix+'-date').value,
    praticien: document.getElementById(prefix+'-praticien').value.trim().toUpperCase(),
    categorie: document.getElementById(prefix+'-categorie').value,
    montant: parseFloat(document.getElementById(prefix+'-montant').value),
    reglement: document.getElementById(prefix+'-mode').value,
    banque: document.getElementById(prefix+'-banque').value,
    commentaire: document.getElementById(prefix+'-comment').value.trim(),
  };
}

function validateForm(d, prefix) {
  let ok = true;
  const clear = id => { const el = document.getElementById(prefix+'-err-'+id); if(el) { el.textContent=''; } const inp = document.getElementById(prefix+'-'+id); if(inp) inp.classList.remove('error'); };
  const err = (id, msg) => { ok=false; const el = document.getElementById(prefix+'-err-'+id); if(el) el.textContent=msg; const inp = document.getElementById(prefix+'-'+id); if(inp) inp.classList.add('error'); };
  ['praticien','categorie','montant'].forEach(clear);
  if (!d.praticien) err('praticien','Ce champ est obligatoire');
  if (!d.categorie) err('categorie','Choisissez une cat√©gorie');
  if (!d.montant || d.montant <= 0 || isNaN(d.montant)) err('montant','Montant invalide');
  return ok;
}

// Modal form
function openForm(id = null) {
  editId = id;
  const existing = id ? allData.find(d=>d.id===id) : null;
  document.getElementById('modal-title').textContent = id ? '‚úèÔ∏è Modifier le r√®glement' : 'Ôºã Nouveau r√®glement';
  document.getElementById('modal-form-body').innerHTML = formHTML(existing || {}, false);
  document.getElementById('form-modal-bg').classList.add('open');
}
function closeForm() {
  document.getElementById('form-modal-bg').classList.remove('open');
  editId = null;
}
function saveForm() {
  const d = collectForm('fm');
  if (!validateForm(d,'fm')) return;
  if (editId) {
    const idx = allData.findIndex(x=>x.id===editId);
    if (idx > -1) { allData[idx] = { ...allData[idx], ...d }; }
    showToast('‚úÖ R√®glement modifi√© !');
  } else {
    d.id = uid();
    d.num = nextNum(d.month);
    d.createdAt = Date.now();
    allData.push(d);
    showToast('‚úÖ R√®glement enregistr√© ‚Äî N¬∞' + d.num);
  }
  saveData();
  renderAll();
  closeForm();
}

// Inline form (saisie page)
function renderInlineForm() {
  document.getElementById('inline-form').innerHTML = formHTML({}, true) + `
    <div style="display:flex;gap:10px;margin-top:20px;padding-top:16px;border-top:1px solid var(--border);">
      <button class="btn btn-gold" onclick="saveInlineForm()" style="flex:1">üíæ Enregistrer le r√®glement</button>
      <button class="btn btn-outline" onclick="resetInlineForm()">‚úï R√©initialiser</button>
    </div>
    <div id="il-success" style="display:none;margin-top:14px;background:var(--green-light);border:1px solid var(--green);border-radius:8px;padding:12px 16px;font-size:13px;color:var(--green);font-weight:600;"></div>`;
}
function saveInlineForm() {
  const d = collectForm('il');
  if (!validateForm(d,'il')) return;
  d.id = uid();
  d.num = nextNum(d.month);
  d.createdAt = Date.now();
  allData.push(d);
  saveData();
  renderAll();
  const succ = document.getElementById('il-success');
  succ.style.display = 'block';
  succ.innerHTML = `‚úÖ R√®glement N¬∞${d.num} enregistr√© ‚Äî <strong>${d.praticien}</strong> ‚Äî ${fmt(d.montant)}`;
  setTimeout(() => { succ.style.display='none'; resetInlineForm(); }, 3000);
}
function resetInlineForm() { renderInlineForm(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DELETE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function askDelete(id) {
  deleteId = id;
  const d = allData.find(x=>x.id===id);
  document.getElementById('confirm-text').textContent = `Supprimer le r√®glement de ${d?.praticien||''} (${fmt(d?.montant||0)}) ?`;
  document.getElementById('confirm-bg').classList.add('open');
}
function closeConfirm() { document.getElementById('confirm-bg').classList.remove('open'); deleteId=null; }
function confirmDelete() {
  if (!deleteId) return;
  allData = allData.filter(d=>d.id!==deleteId);
  saveData(); renderAll();
  closeConfirm();
  showToast('üóëÔ∏è R√®glement supprim√©');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TABLE & FILTERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderMonthTabs() {
  const tabs = document.getElementById('month-tabs');
  tabs.innerHTML = MONTHS_2026.map(m => {
    const hasData = allData.some(d=>d.month===m);
    return `<div class="month-tab ${m===activeMonth?'active':''} ${hasData&&m!==activeMonth?'has-data':''}" onclick="setActiveMonth('${m}')">${m.split(' ')[0].substring(0,4)}</div>`;
  }).join('');
}

function setActiveMonth(m) {
  activeMonth = m;
  renderMonthTabs();
  applyFilters();
}

function applyFilters() {
  const search = (document.getElementById('search-input')?.value || '').toLowerCase();
  const cat = document.getElementById('f-cat')?.value || '';
  const mode = document.getElementById('f-mode')?.value || '';

  let base = allData.filter(d => d.month === activeMonth);
  if (search) base = base.filter(d => d.praticien.toLowerCase().includes(search));
  if (cat) base = base.filter(d => normCat(d.categorie) === cat);
  if (mode) base = base.filter(d => (d.reglement||'').toUpperCase().includes(mode));

  base.sort((a,b) => {
    let va = a[sortState.col], vb = b[sortState.col];
    if (typeof va === 'string') va = va.toLowerCase();
    if (typeof vb === 'string') vb = vb.toLowerCase();
    return sortState.dir * (va > vb ? 1 : va < vb ? -1 : 0);
  });

  filteredData = base;
  currentPage = 1;
  document.getElementById('filter-count').textContent = `${filteredData.length} r√©sultat${filteredData.length>1?'s':''}`;

  // Month summary
  const mTotal = allData.filter(d=>d.month===activeMonth).reduce((s,d)=>s+d.montant,0);
  const mCount = allData.filter(d=>d.month===activeMonth).length;
  document.getElementById('month-summary-bar').innerHTML = `
    <div class="month-stat"><div class="month-stat-label">Total ${activeMonth}</div><div class="month-stat-val">${fmtShort(mTotal)} FCFA</div></div>
    <div class="month-stat"><div class="month-stat-label">R√®glements</div><div class="month-stat-val">${mCount}</div></div>
    <div class="month-stat"><div class="month-stat-label">Praticiens</div><div class="month-stat-val">${new Set(allData.filter(d=>d.month===activeMonth).map(d=>d.praticien)).size}</div></div>
    <div class="month-stat"><div class="month-stat-label">Moy. par r√®glement</div><div class="month-stat-val">${mCount?fmtShort(Math.round(mTotal/mCount)):0} FCFA</div></div>`;

  renderTable();
}

function sortBy(col) {
  if (sortState.col === col) sortState.dir *= -1;
  else { sortState.col = col; sortState.dir = 1; }
  applyFilters();
}
function resetFilters() {
  document.getElementById('search-input').value = '';
  document.getElementById('f-cat').value = '';
  document.getElementById('f-mode').value = '';
  applyFilters();
}

function renderTable() {
  const start = (currentPage-1)*PER_PAGE;
  const slice = filteredData.slice(start, start+PER_PAGE);
  const tbody = document.getElementById('table-body');

  if (slice.length === 0) {
    tbody.innerHTML = `<tr><td colspan="8"><div class="empty"><div class="empty-icon">üìã</div><h3>${allData.filter(d=>d.month===activeMonth).length===0?'Aucun r√®glement ce mois':'Aucun r√©sultat'}</h3><p>${allData.filter(d=>d.month===activeMonth).length===0?'Cliquez sur ¬´ Ajouter ¬ª pour saisir le premier r√®glement.':'Modifiez vos filtres.'}</p></div></td></tr>`;
  } else {
    tbody.innerHTML = slice.map(d => `
      <tr>
        <td style="font-weight:700;color:var(--ink3)">${d.num||'‚Äî'}</td>
        <td style="max-width:180px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;" title="${d.praticien}"><strong>${d.praticien}</strong></td>
        <td><span class="${badgeClass(d.categorie)}">${normCat(d.categorie)}</span></td>
        <td class="montant-cell">${fmt(d.montant)}</td>
        <td>${d.date||'‚Äî'}</td>
        <td><span style="font-size:12px;color:var(--ink2)">${d.reglement||'‚Äî'}</span></td>
        <td style="font-size:12px;color:var(--ink3)">${d.banque||'‚Äî'}</td>
        <td><div class="action-btns">
          <button class="icon-btn edit" onclick="openForm('${d.id}')" title="Modifier">‚úèÔ∏è</button>
          <button class="icon-btn del" onclick="askDelete('${d.id}')" title="Supprimer">üóëÔ∏è</button>
        </div></td>
      </tr>`).join('');
  }

  const total = filteredData.length;
  const pages = Math.ceil(total/PER_PAGE);
  document.getElementById('pag-info').textContent = `${start+1}‚Äì${Math.min(start+PER_PAGE,total)} sur ${total}`;
  const btns = document.getElementById('pag-btns');
  btns.innerHTML = '';
  for (let p=1; p<=Math.min(pages,7); p++) {
    const b = document.createElement('button');
    b.className = 'pag-btn' + (p===currentPage?' active':'');
    b.textContent = p;
    b.onclick = () => { currentPage=p; renderTable(); };
    btns.appendChild(b);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CATEGORIES PAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderCategories() {
  const catMap = {}, catCount = {};
  allData.forEach(d => {
    const c = normCat(d.categorie);
    catMap[c] = (catMap[c]||0) + d.montant;
    catCount[c] = (catCount[c]||0) + 1;
  });
  const sorted = Object.entries(catMap).sort((a,b)=>b[1]-a[1]);
  const labels = sorted.map(e=>e[0]);
  const totals = sorted.map(e=>e[1]);
  const counts = labels.map(l=>catCount[l]);
  const colors = labels.map(l=>CAT_COLORS[l]||'#9a948e');

  if (charts.catBar) charts.catBar.destroy();
  if (totals.length) {
    charts.catBar = new Chart(document.getElementById('chart-cat-bar'), {
      type:'bar',
      data:{ labels, datasets:[{ data:totals, backgroundColor:colors, borderRadius:6 }] },
      options:{ indexAxis:'y', responsive:true, plugins:{legend:{display:false},tooltip:{callbacks:{label:ctx=>fmt(ctx.raw)}}}, scales:{ x:{grid:{color:'#f0ede8'},ticks:{color:'#9a948e',callback:v=>fmtShort(v)}}, y:{grid:{display:false},ticks:{color:'#5c5650'}} } }
    });
  }

  if (charts.catCount) charts.catCount.destroy();
  if (counts.length) {
    charts.catCount = new Chart(document.getElementById('chart-cat-count'), {
      type:'bar',
      data:{ labels, datasets:[{ data:counts, backgroundColor:colors.map(c=>c+'55'), borderColor:colors, borderWidth:1, borderRadius:6 }] },
      options:{ indexAxis:'y', responsive:true, plugins:{legend:{display:false}}, scales:{ x:{grid:{color:'#f0ede8'},ticks:{color:'#9a948e'}}, y:{grid:{display:false},ticks:{color:'#5c5650'}} } }
    });
  }

  const maxT = totals[0]||1;
  document.getElementById('cat-detail').innerHTML = sorted.length ? sorted.map(([n,v],i) => `
    <div class="bar-stat">
      <span class="bar-name" style="min-width:200px">${n}</span>
      <div class="bar-track"><div class="bar-fill" style="width:${(v/maxT*100).toFixed(1)}%;background:${colors[i]}"></div></div>
      <span class="bar-val" style="color:${colors[i]}">${fmt(v)}</span>
      <span style="font-size:11px;color:var(--ink3);margin-left:10px">${catCount[n]} r√©gl.</span>
    </div>`).join('')
    : '<div class="empty"><p>Aucune donn√©e pour le moment.</p></div>';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EXPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function exportCSV() {
  const rows = [['N¬∞','Mois','Praticien','Cat√©gorie','Montant','Date','Mode','Banque','Commentaire']];
  allData.forEach(d => rows.push([d.num||'',d.month,d.praticien,normCat(d.categorie),d.montant,d.date||'',d.reglement||'',d.banque||'',d.commentaire||'']));
  const csv = rows.map(r => r.map(c=>'"'+String(c).replace(/"/g,'""')+'"').join(',')).join('\n');
  const a = document.createElement('a');
  a.href = 'data:text/csv;charset=utf-8,\uFEFF' + encodeURIComponent(csv);
  a.download = 'reglements_praticiens_2026.csv';
  a.click();
  showToast('‚úÖ Export CSV pr√™t');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// IMPORT EXCEL / CSV
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let importData = [];

function downloadTemplate() {
  const header = 'Mois;Praticien;Cat√©gorie;Montant;Date;Mode;Banque;Commentaire';
  const example1 = 'FEVRIER 2026;PHARMACIE CENTRALE;PHARMACIE;1500000;18/02/2026;VIREMENT;FBN BANK;';
  const example2 = 'FEVRIER 2026;CLINIQUE DU PLATEAU;CLINIQUE;2000000;18/02/2026;ESPECES;CBAO;R√®glement janvier';
  const csv = header + '\r\n' + example1 + '\r\n' + example2;
  const blob = new Blob(['\uFEFF' + csv], {type:'text/csv;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'modele_import_reglements.csv';
  a.click();
  showToast('‚úÖ Mod√®le t√©l√©charg√© ‚Äî ouvrez avec Excel !');
}

function handleFileDrop(e) {
  e.preventDefault();
  document.getElementById('drop-zone').style.background = 'rgba(255,255,255,0.5)';
  const file = e.dataTransfer.files[0];
  if (file) parseImportFile(file);
}

function handleFileSelect(input) {
  const file = input.files[0];
  if (file) parseImportFile(file);
  input.value = '';
}

function parseImportFile(file) {
  const reader = new FileReader();
  reader.onload = e => {
    try {
      const text = e.target.result;
      // D√©tecter s√©parateur (virgule ou point-virgule)
      const lines = text.split(/\r?\n/).filter(l => l.trim());
      if (lines.length < 2) { showToast('‚ùå Fichier vide ou invalide'); return; }

      const sep = lines[0].includes(';') ? ';' : ',';
      const headers = lines[0].split(sep).map(h => h.replace(/"/g,'').trim().toLowerCase());

      // Mapping flexible des colonnes
      const colMap = {};
      headers.forEach((h,i) => {
        if (h.includes('mois')) colMap.month = i;
        if (h.includes('pratic')) colMap.praticien = i;
        if (h.includes('cat')) colMap.categorie = i;
        if (h.includes('mont')) colMap.montant = i;
        if (h.includes('date')) colMap.date = i;
        if (h.includes('mode') || h.includes('r√®gl') || h.includes('regl')) colMap.reglement = i;
        if (h.includes('banq')) colMap.banque = i;
        if (h.includes('comm')) colMap.commentaire = i;
      });

      importData = [];
      const errors = [];

      lines.slice(1).forEach((line, idx) => {
        if (!line.trim()) return;
        const cols = line.split(sep).map(c => c.replace(/^"|"$/g,'').trim());

        const row = {
          id: uid(),
          createdAt: Date.now() + idx,
          month: cols[colMap.month] || currentMonthName(),
          praticien: (cols[colMap.praticien] || '').toUpperCase().trim(),
          categorie: cols[colMap.categorie] || '',
          montant: parseFloat((cols[colMap.montant] || '0').replace(/\s/g,'').replace(',','.')),
          date: formatDateImport(cols[colMap.date] || ''),
          reglement: (cols[colMap.reglement] || 'VIREMENT').toUpperCase(),
          banque: cols[colMap.banque] || 'FBN BANK',
          commentaire: cols[colMap.commentaire] || '',
        };

        // Validation
        let valid = true;
        if (!row.praticien) { errors.push(`Ligne ${idx+2}: Praticien manquant`); valid = false; }
        if (!row.montant || isNaN(row.montant) || row.montant <= 0) { errors.push(`Ligne ${idx+2}: Montant invalide`); valid = false; }

        // Auto-num√©ro sera calcul√© √† l'import
        row._valid = valid;
        importData.push(row);
      });

      showImportPreview(importData, errors);
    } catch(err) {
      showToast('‚ùå Erreur lecture fichier: ' + err.message);
    }
  };
  reader.readAsText(file, 'UTF-8');
}

function formatDateImport(dateStr) {
  if (!dateStr) return new Date().toISOString().slice(0,10);
  // Format DD/MM/YYYY ‚Üí YYYY-MM-DD
  const parts = dateStr.split(/[\/\-\.]/);
  if (parts.length === 3) {
    if (parts[2].length === 4) return `${parts[2]}-${parts[1].padStart(2,'0')}-${parts[0].padStart(2,'0')}`;
    if (parts[0].length === 4) return `${parts[0]}-${parts[1].padStart(2,'0')}-${parts[2].padStart(2,'0')}`;
  }
  return dateStr;
}

function showImportPreview(rows, errors) {
  const validRows = rows.filter(r => r._valid);
  const invalidRows = rows.filter(r => !r._valid);

  document.getElementById('import-preview').style.display = 'block';
  document.getElementById('import-preview-title').textContent =
    `Aper√ßu ‚Äî ${validRows.length} r√®glement(s) pr√™ts √† importer${invalidRows.length ? ` ¬∑ ${invalidRows.length} erreur(s)` : ''}`;

  const tbody = document.getElementById('import-preview-body');
  tbody.innerHTML = rows.map((r,i) => `
    <tr style="border-bottom:1px solid var(--border);background:${r._valid ? '' : '#fff5f5'}">
      <td style="padding:7px 10px;color:var(--ink3)">${i+1}</td>
      <td style="padding:7px 10px;font-weight:600;font-size:12px">${r.praticien||'‚Äî'}</td>
      <td style="padding:7px 10px;font-size:12px">${normCat(r.categorie)}</td>
      <td style="padding:7px 10px;font-family:Bricolage Grotesque,sans-serif;color:var(--green);font-weight:700">${r.montant ? fmt(r.montant) : '‚ùå'}</td>
      <td style="padding:7px 10px;font-size:12px">${r.date||'‚Äî'}</td>
      <td style="padding:7px 10px;font-size:12px">${r.reglement||'‚Äî'}</td>
      <td style="padding:7px 10px;font-size:12px">${r.banque||'‚Äî'}</td>
      <td style="padding:7px 10px">${r._valid ? '<span style="color:var(--green);font-weight:700">‚úÖ</span>' : '<span style="color:var(--red);font-weight:700">‚ùå</span>'}</td>
    </tr>`).join('');

  document.getElementById('import-summary').innerHTML =
    `<strong>${validRows.length}</strong> r√®glement(s) valides ¬∑ <strong style="color:var(--red)">${invalidRows.length}</strong> erreur(s)` +
    (errors.length ? `<br><span style="color:var(--red)">${errors.slice(0,3).join(' ¬∑ ')}</span>` : '');

  document.getElementById('import-confirm-btn').textContent = `‚úÖ Importer ${validRows.length} r√®glement(s)`;
}

async function confirmImport() {
  const validRows = importData.filter(r => r._valid);
  if (!validRows.length) { showToast('‚ùå Aucune ligne valide √† importer'); return; }

  // Calculer les num√©ros auto
  validRows.forEach(r => {
    r.num = nextNum(r.month);
    allData.push(r);
  });

  await saveData();
  renderAll();
  cancelImport();
  showToast(`‚úÖ ${validRows.length} r√®glement(s) import√©s avec succ√®s !`);
}

function cancelImport() {
  importData = [];
  document.getElementById('import-preview').style.display = 'none';
  document.getElementById('csv-file-input').value = '';
}
function toggleExportMenu() {
  const menu = document.getElementById('export-menu');
  menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
}
document.addEventListener('click', e => {
  const wrap = document.getElementById('export-menu-wrap');
  if (wrap && !wrap.contains(e.target)) {
    const menu = document.getElementById('export-menu');
    if (menu) menu.style.display = 'none';
  }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
loadData();
</script>
</body>
</html>
